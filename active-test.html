<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE Portal | Elite Exam Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
            --navy: #0f172a;
            --navy-hover: #1e293b;
            --grey-btn: #f1f5f9; /* LIGHT GREY */
            --grey-hover: #e2e8f0;
            --correct: #10b981;
            --purple: #8b5cf6;
            --accent-blue: #3b82f6;
            --thin-line: #e2e8f0; 
        }

        /* Animations */
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top left, #e0e7ff, #f8fafc);
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* Layout Styles */
        header {
            background: var(--glass); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 50px; display: flex; justify-content: space-between; align-items: center;
        }
        .main-layout { display: flex; flex: 1; padding: 25px; gap: 25px; overflow: hidden; }
        .test-engine { flex: 1; background: var(--glass); border-radius: 30px; border: 1px solid var(--glass-border); display: flex; flex-direction: column; overflow: hidden; }
        .palette-card { width: 350px; background: var(--glass); border-radius: 30px; border: 1px solid var(--glass-border); display: flex; flex-direction: column; }
        .palette-grid { padding: 20px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; overflow-y: auto; }

        /* CIRCLE LOGIC FIXED HERE */
        .p-circle { 
            aspect-ratio: 1/1; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 600; 
            cursor: pointer; 
            background: var(--grey-btn); /* Default Light Grey */
            color: #64748b; 
            font-size: 0.85rem; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            border: 2px solid transparent; 
            margin: 3px; 
        }

        /* Hover: Blue Border appearing on top of the grey */
        .p-circle:hover { 
            border-color: var(--accent-blue); 
            transform: scale(1.15); 
            background: white; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); 
        }

        /* Active Question: Light Grey background with Blue Border */
        .p-circle.active { 
            border: 3px solid var(--accent-blue) !important; 
            background: var(--grey-btn); 
            color: var(--accent-blue); 
            animation: pulse-blue 2s infinite; 
            transform: scale(1.1);
        }

        /* Answered/Marked: Only these classes change the background color */
        .p-circle.answered { background: var(--correct) !important; color: white; border-color: transparent; }
        .p-circle.marked { background: var(--purple) !important; color: white; border-color: transparent; }

        /* Existing Styles... */
        .btn { padding: 12px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; border: none; }
        .btn-finish { background: var(--navy); color: white; }
    </style>
</head>
<body>

<header>
    <h2 id="testTitle">Loading Test...</h2>
    <div id="timer">00:00</div>
</header>

<div class="main-layout">
    <div class="test-engine">
        <div id="questionArea" class="q-scroll-area">
            </div>
        <footer class="footer-nav">
            <button class="btn btn-grey" onclick="markForReview()">Mark for Review</button>
            <button class="btn btn-grey" onclick="clearResponse()">Clear</button>
            <button class="btn btn-finish" onclick="saveAndNext()">Save & Next</button>
        </footer>
    </div>

    <div class="palette-card">
        <div class="palette-header"><h3>Question Palette</h3></div>
        <div id="paletteGrid" class="palette-grid"></div>
    </div>
</div>

<script>
    // Logic updated to handle the grey background priority
    let questions = [];
    let currentIdx = 0;
    let userAnswers = {};
    let marked = {};

    function updatePaletteUI() {
        questions.forEach((_, i) => {
            const el = document.getElementById(`pc-${i}`);
            if(!el) return;

            // Reset to base state (removes old colors)
            el.className = 'p-circle'; 

            // Priority Logic:
            // 1. Current Question (Active) gets the Blue Border
            if(i === currentIdx) {
                el.classList.add('active');
            }

            // 2. State-based colors
            if(marked[i]) {
                el.classList.add('marked');
            } else if(userAnswers[i] !== undefined && userAnswers[i] !== null) {
                el.classList.add('answered');
            }
            // If neither, it stays purely 'p-circle' which is light grey.
        });
    }

    // Initialize palette
    function initPalette(count) {
        const grid = document.getElementById('paletteGrid');
        grid.innerHTML = '';
        for(let i=0; i<count; i++) {
            const div = document.createElement('div');
            div.id = `pc-${i}`;
            div.className = 'p-circle';
            div.innerText = i + 1;
            div.onclick = () => jumpToQuestion(i);
            grid.appendChild(div);
        }
        updatePaletteUI();
    }

    // Dummy navigation to test UI
    function jumpToQuestion(idx) {
        currentIdx = idx;
        updatePaletteUI();
    }
</script>
</body>
</html>
